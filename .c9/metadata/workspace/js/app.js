{"changed":true,"filter":false,"title":"app.js","tooltip":"/js/app.js","value":"requirejs.config({\n    paths: {\n        rivets: 'https://cdnjs.cloudflare.com/ajax/libs/rivets/0.8.1/rivets.min',\n        sightglass: 'https://cdn.rawgit.com/mikeric/sightglass/master/index'\n    },\n    shim: {}\n});\n\ndefine(['rivets', './utils'], function(rivets, utils) {\n    //defining it here cause require\n//binder -- sets start point\n    rivets.binders.startvalue = function(element, value) {\n        addNewData();\n    };\n//formatter -- hides zeros    \n    rivets.formatters.hidezero = function(value) {\n        if (value !== 0)\n            return value;\n    };\n\n    var view = document.querySelector(\"#view\");\n\n    function addNewData() {\n        var cell = new utils.Cell(utils.getRandomCoord(), utils.getRandomCoord(), utils.twoOrFour()),\n            emptyIndexes = [];\n        for (var i = 0; i < viewModel.cells.length; i++) {\n            if (viewModel.cells[i].data === 0) emptyIndexes.push(i);\n        }\n        var elementIndex = emptyIndexes[utils.getRandomInt(0, emptyIndexes.length - 1)];\n        if (elementIndex >= 0) {\n            viewModel.cells[elementIndex].data = cell.data;\n        }\n    }\n\n    var viewModel = {\n        cells: utils.fillMain(),\n        buttons: [\"up\", \"down\", \"left\", \"right\"],\n        shift: function(way) {\n            switch (way) {\n                case 0:\n                    //up\n                    var matrixTransp = utils.transponation(utils.arrayToMatrix(utils.getData(viewModel.cells)));\n                    matrixTransp = utils.shiftReduceRight(matrixTransp);\n                    viewModel.cells = utils.fillMain(utils.concatenate(utils.transponation(matrixTransp)));\n                    break;\n                case 1:\n                    //down\n                    var matrixTransp = utils.transponation(utils.arrayToMatrix(utils.getData(viewModel.cells)));\n                    matrixTransp = utils.shiftReduceLeft(matrixTransp);\n                    viewModel.cells = utils.fillMain(utils.concatenate(utils.transponation(matrixTransp)));\n                    break;\n                case 2:\n                    //left\n                    var matrix = utils.arrayToMatrix(utils.getData(viewModel.cells));\n                    matrix = utils.shiftReduceRight(matrix);\n                    viewModel.cells = utils.fillMain(utils.concatenate((matrix)));\n                    break;\n                case 3:\n                    //right\n                    var matrix = utils.arrayToMatrix(utils.getData(viewModel.cells));\n                    matrix = utils.shiftReduceLeft(matrix);\n                    viewModel.cells = utils.fillMain(utils.concatenate((matrix)));\n                    break;\n            }\n        },\n\n        operate: function(ev, el) {\n            viewModel.shift(el.index);\n            addNewData();\n        }\n\n\n    };\n\n    rivets.bind(view, {\n        \"model\": viewModel\n    });\n});","undoManager":{"mark":97,"position":100,"stack":[[{"start":{"row":60,"column":86},"end":{"row":60,"column":87},"action":"insert","lines":[")"],"id":8394}],[{"start":{"row":60,"column":72},"end":{"row":60,"column":84},"action":"remove","lines":["matrixTransp"],"id":8395},{"start":{"row":60,"column":72},"end":{"row":60,"column":78},"action":"insert","lines":["matrix"]}],[{"start":{"row":66,"column":20},"end":{"row":68,"column":24},"action":"remove","lines":["viewModel.cells = utils.fillMain(matrix.join(\",\").split(\",\").map(function(el) {","                        return parseInt(el, 10);","                    }));"],"id":8396},{"start":{"row":66,"column":20},"end":{"row":66,"column":82},"action":"insert","lines":["viewModel.cells = utils.fillMain(utils.concatenate((matrix)));"]}],[{"start":{"row":41,"column":0},"end":{"row":41,"column":76},"action":"remove","lines":["                    // [,,,,,,,,] ---> [[],[],[],[]] + транспонируем матрицу"],"id":8397}],[{"start":{"row":41,"column":0},"end":{"row":42,"column":0},"action":"remove","lines":["",""],"id":8398}],[{"start":{"row":43,"column":0},"end":{"row":43,"column":43},"action":"remove","lines":["                    //транспонируем обратно"],"id":8399}],[{"start":{"row":43,"column":0},"end":{"row":44,"column":0},"action":"remove","lines":["",""],"id":8400}],[{"start":{"row":47,"column":0},"end":{"row":47,"column":43},"action":"remove","lines":["                    //транспонируем матрицу"],"id":8401}],[{"start":{"row":47,"column":0},"end":{"row":48,"column":0},"action":"remove","lines":["",""],"id":8402}],[{"start":{"row":49,"column":0},"end":{"row":49,"column":47},"action":"remove","lines":["                        //транспонируем обратно"],"id":8403}],[{"start":{"row":49,"column":0},"end":{"row":50,"column":0},"action":"remove","lines":["",""],"id":8404}],[{"start":{"row":54,"column":60},"end":{"row":55,"column":20},"action":"remove","lines":["","                    "],"id":8405}],[{"start":{"row":77,"column":0},"end":{"row":78,"column":0},"action":"remove","lines":["",""],"id":8406}],[{"start":{"row":79,"column":0},"end":{"row":257,"column":6},"action":"remove","lines":["","","","// var view = document.querySelector(\"#view\")","","// var Cell = function(x, y, data) {","//     this.x = x;","//     this.y = y;","//     this.data = data || 0;","// }","","","// // function fillMain(dataArray) {","","// //     var array = [];","// //     for (var y = 0; y < 4; y++) {","// //         for (var x = 0; x < 4; x++) {","// //             array.push(new Cell(x, y));","// //         }","// //     }","// //     if (dataArray) {","// //         for (var i = 0; i < array.length; i++) {","// //             array[i].data = dataArray[i];","// //         }","// //     }","// //     return array;","// // }","","// // function getRandomCoord() {","// //     return Math.floor(Math.random() * 4);","// // }","","// // function twoOrFour() {","// //     if (Math.random() < 0.2) return 4;","// //     else return 2;","// // }","","// // function getRandomInt(min, max) {","// //     return Math.floor(Math.random() * (max - min + 1)) + min;","// // }","","// function addNewData() {","//     var cell = new Cell(getRandomCoord(), getRandomCoord(), twoOrFour());","//     var emptyIndexes = [];","//     for (var i = 0; i < viewModel.cells.length; i++) {","//         if (viewModel.cells[i].data === 0) emptyIndexes.push(i);","//     }","//     var elementIndex = emptyIndexes[getRandomInt(0, emptyIndexes.length - 1)];","//     if (elementIndex >= 0) {","//         viewModel.cells[elementIndex].data = cell.data;","//     }","// }","","","// // function swap(array, a, b) {","// //     var temp = array[a];","// //     array[a] = array[b];","// //     array[b] = temp;","// // }","","// // function transponation(matrix) {","// //     var matrixTransp = [","// //         [],","// //         [],","// //         [],","// //         []","// //     ];","// //     matrix.forEach(function(el) {","// //         for (var i = 0; i < el.length; i++) {","// //             matrixTransp[i].push(el[i]);","// //         }","// //     })","// //     return matrixTransp;","// // }","","// // function getData(array) {","// //     var dataArray = array.map(function(el) {","// //         return el.data;","// //     });","// //     return dataArray;","// // }","","// // function arrayToMatrix(dataArray) {","// //     var partOfOrigin, matrix = [];","// //     for (var i = 0; i < 15; i += 4) {","// //         partOfOrigin = dataArray.slice(i, i + 4);","// //         matrix.push(partOfOrigin);","// //     }","// //     return matrix;","// // }","","// // function shiftReduceRight(matrix) {","// //     matrix.forEach(function(el, index) {","// //         for (var j = el.length - 2; j >= 0; j--) {","// //             if (el[j] === 0) {","// //                 swap(el, j + 1, j);","// //             }","// //             if (el[j + 1] === el[j]) {","// //                 el[j] = el[j + 1] + el[j];","// //                 el[j + 1] = 0;","// //             }","// //         }","// //     })","// //     return matrix;","// // }","","// // function shiftReduceLeft(matrix) {","// //     matrix.forEach(function(el, index) {","// //         for (var j = 1; j < el.length; j++) {","// //             if (el[j] === 0) {","// //                 swap(el, j - 1, j);","// //             }","// //             if (el[j - 1] === el[j]) {","// //                 el[j] = el[j - 1] + el[j];","// //                 el[j - 1] = 0;","// //             }","// //         }","// //     });","// //     return matrix;","// // }","","","// var viewModel = {","//     cells: fillMain(),","//     buttons: [\"up\", \"down\", \"left\", \"right\"],","//     shift: function(way) {","//         switch (way) {","//             case 0:","//                 //up","//                 // [,,,,,,,,] ---> [[],[],[],[]] + транспонируем матрицу","//                 var matrixTransp = transponation(arrayToMatrix(getData(viewModel.cells)));","//                 matrixTransp = shiftReduceRight(matrixTransp);","//                 //транспонируем обратно","//                 viewModel.cells = fillMain(transponation(matrixTransp).join(\",\").split(\",\").map(function(el) {","//                     return parseInt(el, 10);//[[],[],[],[]] ---> [,,,,,,,,]","//                 }));","//                 break;","//             case 1:","//                 //down","//                 //транспонируем матрицу","//                 var matrixTransp = transponation(arrayToMatrix(getData(viewModel.cells)));","//                 matrixTransp = shiftReduceLeft(matrixTransp)","//                 //транспонируем обратно","//                 viewModel.cells = fillMain(transponation(matrixTransp).join(\",\").split(\",\").map(function(el) {","//                     return parseInt(el, 10);","//                 }));","//                 break;","//             case 2:","//                 //left","//                 var matrix = arrayToMatrix(getData(viewModel.cells));","","//                 matrix = shiftReduceRight(matrix);","","//                 viewModel.cells = fillMain(matrix.join(\",\").split(\",\").map(function(el) {","//                     return parseInt(el, 10);","//                 }));","//                 break;","//             case 3:","//                 //right","//                 var matrix = arrayToMatrix(getData(viewModel.cells));","//                     matrix = shiftReduceLeft(matrix);","//                 viewModel.cells = fillMain(matrix.join(\",\").split(\",\").map(function(el) {","//                     return parseInt(el, 10);","//                 }));","//                 break;","//         }","//     },","","//     operate: function(ev, el) {","//         viewModel.shift(el.index);","//         addNewData();","//     }","","","// }","","// rivets.bind(view, {","//     \"model\": viewModel","// });"],"id":8407}],[{"start":{"row":78,"column":2},"end":{"row":79,"column":0},"action":"remove","lines":["",""],"id":8408}],[{"start":{"row":23,"column":100},"end":{"row":23,"column":101},"action":"remove","lines":[";"],"id":8410}],[{"start":{"row":23,"column":100},"end":{"row":23,"column":101},"action":"insert","lines":[","],"id":8411}],[{"start":{"row":24,"column":8},"end":{"row":24,"column":9},"action":"remove","lines":["v"],"id":8412}],[{"start":{"row":24,"column":8},"end":{"row":24,"column":9},"action":"remove","lines":["a"],"id":8413}],[{"start":{"row":24,"column":8},"end":{"row":24,"column":9},"action":"remove","lines":["r"],"id":8414}],[{"start":{"row":24,"column":8},"end":{"row":24,"column":9},"action":"remove","lines":[" "],"id":8415}],[{"start":{"row":24,"column":8},"end":{"row":24,"column":12},"action":"insert","lines":["    "],"id":8416}],[{"start":{"row":9,"column":8},"end":{"row":9,"column":9},"action":"insert","lines":[" "],"id":8417}],[{"start":{"row":9,"column":9},"end":{"row":9,"column":10},"action":"insert","lines":["s"],"id":8418}],[{"start":{"row":9,"column":10},"end":{"row":9,"column":11},"action":"insert","lines":["e"],"id":8419}],[{"start":{"row":9,"column":11},"end":{"row":9,"column":12},"action":"insert","lines":["t"],"id":8420}],[{"start":{"row":9,"column":12},"end":{"row":9,"column":13},"action":"insert","lines":["s"],"id":8421}],[{"start":{"row":9,"column":13},"end":{"row":9,"column":14},"action":"insert","lines":[" "],"id":8422}],[{"start":{"row":9,"column":14},"end":{"row":9,"column":15},"action":"insert","lines":["s"],"id":8423}],[{"start":{"row":9,"column":15},"end":{"row":9,"column":16},"action":"insert","lines":["t"],"id":8424}],[{"start":{"row":9,"column":16},"end":{"row":9,"column":17},"action":"insert","lines":["a"],"id":8425}],[{"start":{"row":9,"column":17},"end":{"row":9,"column":18},"action":"insert","lines":["r"],"id":8426}],[{"start":{"row":9,"column":18},"end":{"row":9,"column":19},"action":"insert","lines":["t"],"id":8427}],[{"start":{"row":9,"column":19},"end":{"row":9,"column":20},"action":"insert","lines":[" "],"id":8428}],[{"start":{"row":9,"column":20},"end":{"row":9,"column":21},"action":"insert","lines":["p"],"id":8429}],[{"start":{"row":9,"column":21},"end":{"row":9,"column":22},"action":"insert","lines":["o"],"id":8430}],[{"start":{"row":9,"column":22},"end":{"row":9,"column":23},"action":"insert","lines":["i"],"id":8431}],[{"start":{"row":9,"column":23},"end":{"row":9,"column":24},"action":"insert","lines":["n"],"id":8432}],[{"start":{"row":9,"column":24},"end":{"row":9,"column":25},"action":"insert","lines":["t"],"id":8433}],[{"start":{"row":9,"column":8},"end":{"row":9,"column":9},"action":"insert","lines":[" "],"id":8434}],[{"start":{"row":9,"column":9},"end":{"row":9,"column":10},"action":"insert","lines":["-"],"id":8435}],[{"start":{"row":9,"column":10},"end":{"row":9,"column":11},"action":"insert","lines":["-"],"id":8436}],[{"start":{"row":13,"column":11},"end":{"row":13,"column":12},"action":"insert","lines":[" "],"id":8437}],[{"start":{"row":13,"column":12},"end":{"row":13,"column":13},"action":"insert","lines":["-"],"id":8438}],[{"start":{"row":13,"column":13},"end":{"row":13,"column":14},"action":"insert","lines":["-"],"id":8439}],[{"start":{"row":13,"column":14},"end":{"row":13,"column":15},"action":"insert","lines":[" "],"id":8440}],[{"start":{"row":13,"column":15},"end":{"row":13,"column":16},"action":"insert","lines":["h"],"id":8441}],[{"start":{"row":13,"column":16},"end":{"row":13,"column":17},"action":"insert","lines":["e"],"id":8442}],[{"start":{"row":13,"column":16},"end":{"row":13,"column":17},"action":"remove","lines":["e"],"id":8443}],[{"start":{"row":13,"column":16},"end":{"row":13,"column":17},"action":"insert","lines":["i"],"id":8444}],[{"start":{"row":13,"column":17},"end":{"row":13,"column":18},"action":"insert","lines":["d"],"id":8445}],[{"start":{"row":13,"column":18},"end":{"row":13,"column":19},"action":"insert","lines":["e"],"id":8446}],[{"start":{"row":13,"column":19},"end":{"row":13,"column":20},"action":"insert","lines":["s"],"id":8447}],[{"start":{"row":13,"column":20},"end":{"row":13,"column":21},"action":"insert","lines":[" "],"id":8448}],[{"start":{"row":13,"column":21},"end":{"row":13,"column":22},"action":"insert","lines":["z"],"id":8449}],[{"start":{"row":13,"column":22},"end":{"row":13,"column":23},"action":"insert","lines":["e"],"id":8450}],[{"start":{"row":13,"column":23},"end":{"row":13,"column":24},"action":"insert","lines":["r"],"id":8451}],[{"start":{"row":13,"column":24},"end":{"row":13,"column":25},"action":"insert","lines":["o"],"id":8452}],[{"start":{"row":13,"column":25},"end":{"row":13,"column":26},"action":"insert","lines":["s"],"id":8453}],[{"start":{"row":17,"column":8},"end":{"row":17,"column":11},"action":"insert","lines":["// "],"id":8454}],[{"start":{"row":17,"column":0},"end":{"row":17,"column":23},"action":"remove","lines":["        // else return;"],"id":8455}],[{"start":{"row":16,"column":25},"end":{"row":17,"column":0},"action":"remove","lines":["",""],"id":8456}],[{"start":{"row":47,"column":70},"end":{"row":47,"column":71},"action":"insert","lines":[";"],"id":8457}],[{"start":{"row":12,"column":5},"end":{"row":12,"column":6},"action":"insert","lines":[";"],"id":8458}],[{"start":{"row":17,"column":5},"end":{"row":17,"column":6},"action":"insert","lines":[";"],"id":8459}],[{"start":{"row":8,"column":55},"end":{"row":9,"column":0},"action":"insert","lines":["",""],"id":8460},{"start":{"row":9,"column":0},"end":{"row":9,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":9,"column":4},"end":{"row":9,"column":5},"action":"insert","lines":["/"],"id":8461}],[{"start":{"row":9,"column":5},"end":{"row":9,"column":6},"action":"insert","lines":["/"],"id":8462}],[{"start":{"row":9,"column":6},"end":{"row":9,"column":7},"action":"insert","lines":["d"],"id":8463}],[{"start":{"row":9,"column":7},"end":{"row":9,"column":8},"action":"insert","lines":["e"],"id":8464}],[{"start":{"row":9,"column":8},"end":{"row":9,"column":9},"action":"insert","lines":["f"],"id":8465}],[{"start":{"row":9,"column":9},"end":{"row":9,"column":10},"action":"insert","lines":["i"],"id":8466}],[{"start":{"row":9,"column":10},"end":{"row":9,"column":11},"action":"insert","lines":["n"],"id":8467}],[{"start":{"row":9,"column":11},"end":{"row":9,"column":12},"action":"insert","lines":["i"],"id":8468}],[{"start":{"row":9,"column":12},"end":{"row":9,"column":13},"action":"insert","lines":["n"],"id":8469}],[{"start":{"row":9,"column":13},"end":{"row":9,"column":14},"action":"insert","lines":["g"],"id":8470}],[{"start":{"row":9,"column":14},"end":{"row":9,"column":15},"action":"insert","lines":[" "],"id":8471}],[{"start":{"row":9,"column":15},"end":{"row":9,"column":16},"action":"insert","lines":["i"],"id":8472}],[{"start":{"row":9,"column":16},"end":{"row":9,"column":17},"action":"insert","lines":["t"],"id":8473}],[{"start":{"row":9,"column":17},"end":{"row":9,"column":18},"action":"insert","lines":[" "],"id":8474}],[{"start":{"row":9,"column":18},"end":{"row":9,"column":19},"action":"insert","lines":["h"],"id":8475}],[{"start":{"row":9,"column":19},"end":{"row":9,"column":20},"action":"insert","lines":["e"],"id":8476}],[{"start":{"row":9,"column":20},"end":{"row":9,"column":21},"action":"insert","lines":["r"],"id":8477}],[{"start":{"row":9,"column":21},"end":{"row":9,"column":22},"action":"insert","lines":["e"],"id":8478}],[{"start":{"row":9,"column":22},"end":{"row":9,"column":23},"action":"insert","lines":[" "],"id":8479}],[{"start":{"row":9,"column":23},"end":{"row":9,"column":24},"action":"insert","lines":["c"],"id":8480}],[{"start":{"row":9,"column":24},"end":{"row":9,"column":25},"action":"insert","lines":["a"],"id":8481}],[{"start":{"row":9,"column":25},"end":{"row":9,"column":26},"action":"insert","lines":["u"],"id":8482}],[{"start":{"row":9,"column":26},"end":{"row":9,"column":27},"action":"insert","lines":["s"],"id":8483}],[{"start":{"row":9,"column":27},"end":{"row":9,"column":28},"action":"insert","lines":["e"],"id":8484}],[{"start":{"row":9,"column":28},"end":{"row":9,"column":29},"action":"insert","lines":[" "],"id":8485}],[{"start":{"row":9,"column":29},"end":{"row":9,"column":30},"action":"insert","lines":["r"],"id":8486}],[{"start":{"row":9,"column":30},"end":{"row":9,"column":31},"action":"insert","lines":["e"],"id":8487}],[{"start":{"row":9,"column":31},"end":{"row":9,"column":32},"action":"insert","lines":["q"],"id":8488}],[{"start":{"row":9,"column":32},"end":{"row":9,"column":33},"action":"insert","lines":["u"],"id":8489}],[{"start":{"row":9,"column":33},"end":{"row":9,"column":34},"action":"insert","lines":["i"],"id":8490}],[{"start":{"row":9,"column":34},"end":{"row":9,"column":35},"action":"insert","lines":["r"],"id":8491}],[{"start":{"row":9,"column":35},"end":{"row":9,"column":36},"action":"insert","lines":["e"],"id":8492}],[{"start":{"row":72,"column":5},"end":{"row":72,"column":6},"action":"insert","lines":[";"],"id":8493}],[{"start":{"row":78,"column":2},"end":{"row":78,"column":3},"action":"insert","lines":[";"],"id":8494}],[{"start":{"row":76,"column":7},"end":{"row":77,"column":0},"action":"remove","lines":["",""],"id":8495}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":76,"column":7},"end":{"row":76,"column":7},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1436182419945}